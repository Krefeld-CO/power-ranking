<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tabla de Jugadores</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
    }
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.5rem;
      text-align: left;
    }
    th {
      background-color: #f5f5f5;
      cursor: pointer;
    }
    .up {
      color: green;
    }
    .down {
      color: red;
    }
    .same {
      color: gray;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h1>ClasificaciÃ³n de Jugadores</h1>
  <table id="tabla-jugadores">
    <thead></thead>
    <tbody></tbody>
  </table>

  <script>
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRt3yIlHDYrXpteR_emzXy_PO7fcm4_RdjTAEssC5iooIhv2LdHXWWQUSvUiorYnIOYTMAwfVygE6bO/pub?gid=1179758971&single=true&output=csv";

    fetch(CSV_URL)
      .then(response => response.text())
      .then(data => {
        const rows = data.trim().split('\n').map(row => row.split(','));
        const headers = rows[0];
        const tbody = document.querySelector('#tabla-jugadores tbody');
        const thead = document.querySelector('#tabla-jugadores thead');

        // Detect indices de columnas especiales
        const colAnterior = headers.indexOf("ClasificaciÃ³n anterior");
        const colActual = headers.indexOf("ClasificaciÃ³n actual");

        // Construir encabezado
        const visibleHeaders = headers.map((h, i) =>
          (i !== colAnterior && i !== colActual) ? `<th data-col="${i}">${h}</th>` : ''
        ).join('');
        thead.innerHTML = `<tr>${visibleHeaders}<th>Cambio</th></tr>`;

        // Cuerpo
        for (let i = 1; i < rows.length; i++) {
          const row = rows[i];
          const visibleCells = row.map((cell, j) =>
            (j !== colAnterior && j !== colActual) ? `<td>${cell}</td>` : ''
          ).join('');

          // Calcular diferencia
          const actual = parseInt(row[colActual]);
          const anterior = parseInt(row[colAnterior]);
          let diffHTML = '<td class="same">âž–</td>';

          if (!isNaN(actual) && !isNaN(anterior)) {
            const diff = anterior - actual;
            if (diff > 0) {
              diffHTML = `<td class="up">ðŸ”º ${diff}</td>`;
            } else if (diff < 0) {
              diffHTML = `<td class="down">ðŸ”» ${Math.abs(diff)}</td>`;
            }
          }

          tbody.innerHTML += `<tr>${visibleCells}${diffHTML}</tr>`;
        }

        // Ordenar columnas al hacer clic
        document.querySelectorAll("th[data-col]").forEach(th => {
          th.addEventListener("click", () => {
            const colIndex = parseInt(th.dataset.col);
            const rowsArray = Array.from(tbody.querySelectorAll("tr"));

            const isNumeric = !isNaN(rows[1][colIndex].replace(',', '.'));
            const ascending = !th.classList.contains("asc");

            rowsArray.sort((a, b) => {
              const aText = a.children[colIndex].innerText;
              const bText = b.children[colIndex].innerText;
              const valA = isNumeric ? parseFloat(aText.replace(',', '.')) : aText;
              const valB = isNumeric ? parseFloat(bText.replace(',', '.')) : bText;

              return ascending ? (valA > valB ? 1 : -1) : (valA < valB ? 1 : -1);
            });

            tbody.innerHTML = '';
            rowsArray.forEach(tr => tbody.appendChild(tr));

            document.querySelectorAll("th").forEach(th => th.classList.remove("asc", "desc"));
            th.classList.add(ascending ? "asc" : "desc");
          });
        });
      });
  </script>
</body>
</html>
